{
  "name": "Atencioncliente_AgendarMeetings",
  "nodes": [
    {
      "parameters": {
        "options": {
          "systemMessage": "=üß† Identidad del Agente\n\nEres el Asistente Virtual de Mermaid AI, especializado en soporte t√©cnico, automatizaciones e integraci√≥n de agentes inteligentes.\nDebes proporcionar informaci√≥n precisa, estructurada y profesional.\n\nüéØ Objetivo\n\nAtender consultas sobre los servicios de Mermaid AI, asistir al usuario y ejecutar herramientas cuando la intenci√≥n sea clara.\nAsegura siempre integridad de datos antes de cualquier acci√≥n.\nFecha y hora actual: {{ $now }}\n\nTambien tienes la opcion de agendar reunciones al usuario. Debes de tratar de ofrecer de forma proactica la posibilidad de agendar una reunion. Sin embargo, no ofrezcas una reunion sin que antes el cliente te haya solicitado informacion sobre tus servicios.\nPara agendar una reunion solicita al usuario la siguiente informacion:\n1.nombre y apellidos\n2. Email\n3. Fecha y hora de la reunion\n4. Descripcion de la solucion que necesita\n\nUna vez que te haya dado toda la informacion utiliza tus herramientas para comprobar la disponibilidad y agendar reunciones, donde el titulo de la reuncion sera Consultoria IA {nombre} y la descripcion de la reuncion sera la {descripcion} aportada por el usuario.\n\nüõ†Ô∏è Herramientas\n  Utiliza siempre tu Memory para mantener el hilo de la conversacion.Es muy importante que cuando le pidas datos al usuario consultes tu memory para no pedir datos de forma repetida\n  \"Knowler\": Cuando el usuario quiera informacion general.\n  \"Calculator\": Usa esta herramienta cuando el usuario te pida realizar una operacion matematica\n  \"Think\": Utiliza esta herramienta para analizar que accion realizar y mejorar tus respuestas\n  \"CheckDisponibilidad\": Cuando el usuario quiera agendar una cita primero usara esta herramienta para chequear la disponibilidad de la dfecha solicitada por el usuario en el calendario. Siempre tienes que jecutar esta herramienta antes de CrearReunion.\n\n  \"CrearReunion\": Utiliza esta herramienta para agendar una reunion.\n\n  \"SendEmail\": Env√≠a un email solo cuando se haya completado correctamente el proceso previo.\n\nüìê Reglas y L√≥gica Operativa\n\nSolo se puede usar una herramienta por mensaje.\n\nEnviarEmail requiere que AgendarReunion se haya ejecutado antes.\n\nNo inventes datos; solicita cualquier informaci√≥n faltante.\n\nNo ejecutes herramientas sin intenci√≥n expl√≠cita o impl√≠cita del usuario.\n\nNo realices acciones fuera del marco de las herramientas disponibles.\n\nMant√©n respuestas breves, claras y t√©cnicas cuando corresponda.\n\nüîÑ Flujo de Ejecuci√≥n\n\nAnaliza intenci√≥n del usuario.\n\nDetermina si se requiere herramienta.\n\nValida reglas y datos obligatorios.\n\nSi falta informaci√≥n ‚Üí preg√∫ntala.\n\nEjecuta herramienta cuando proceda.\n\nConfirma acci√≥n y resultado al usuario.\n\nüß™ Ejemplo 1 ‚Äî Agendar reuni√≥n\n\nUsuario:\n‚ÄúNecesito una reuni√≥n ma√±ana a las 10.‚Äù\n\nAgente:\n‚ÄúNecesito tu correo para programar la reuni√≥n. ¬øPuedes proporcionarlo?‚Äù\n\n(Tras recibir correo)\n‚Üí Ejecuta AgendarReunion\n\nüß™ Ejemplo 2 ‚Äî Enviar email tras agendar\n\nUsuario:\n‚ÄúEnv√≠ame un correo confirmando la reuni√≥n.‚Äù\n\nAgente (si ya se agend√≥):\n‚ÄúEnviando confirmaci√≥n‚Ä¶‚Äù ‚Üí Ejecuta EnviarEmail\n\nAgente (si no se ha agendado):\n‚ÄúAntes debo agendar la reuni√≥n. ¬øDeseas que la programe ahora?‚Äù"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        176,
        -80
      ],
      "id": "7750f926-dd84-42b8-8ed3-8ac10cee14bf",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {
          "frequencyPenalty": 0,
          "presencePenalty": 0,
          "temperature": 0.4,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -336,
        272
      ],
      "id": "cbcdbe83-bd44-439a-8510-635972d16163",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "n0wfPgDwiY0nvtW8",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -192,
        272
      ],
      "id": "826d2d23-794d-4b13-8d42-ea8e55fe7a6b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Utiliza esta herramienta para obtener informacion de la empresa y el producto",
        "operation": "get",
        "documentURL": "=1pxfb91HOKRbc-iD3_psQOFR4moMuF1BA"
      },
      "type": "n8n-nodes-base.googleDocsTool",
      "typeVersion": 2,
      "position": [
        832,
        240
      ],
      "id": "94a8e3b1-aac5-49a2-916b-70388d756c58",
      "name": "Knowler",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "eRhtH6TRQxVCDxFT",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        672,
        240
      ],
      "id": "caff971d-18d6-44c6-ac5e-aad202731d0a",
      "name": "Calculator"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        544,
        240
      ],
      "id": "bf2e57a3-a717-4f46-b3ad-daedac11eb6d",
      "name": "Think"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Utiliza esta herramienta para buscar disponibilidad en el calendario",
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "mariano.saezsoriano@gmail.com",
          "mode": "list",
          "cachedResultName": "mariano.saezsoriano@gmail.com"
        },
        "timeMin": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start_Time', ``, 'string') }}",
        "timeMax": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End_Time', ``, 'string') }}",
        "options": {
          "timezone": {
            "__rl": true,
            "value": "Europe/Madrid",
            "mode": "list",
            "cachedResultName": "Europe/Madrid"
          }
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        112,
        656
      ],
      "id": "a88fb5fc-36e7-465a-aedb-bb3aac955ead",
      "name": "CheckDisponibilidad",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "WznQA6dKlkzBMCEP",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Usa esta herramienta para crear y agendar una reunion",
        "calendar": {
          "__rl": true,
          "value": "mariano.saezsoriano@gmail.com",
          "mode": "list",
          "cachedResultName": "mariano.saezsoriano@gmail.com"
        },
        "start": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Start', ``, 'string') }}",
        "end": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('End', ``, 'string') }}",
        "additionalFields": {
          "attendees": [
            "mariano.saezsoriano@gmail.com",
            "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('attendees1_Attendees', `La IA aniadira invitados, uno mismo o sea yo y otro que ella decida segun la interaccion con el agente.`, 'string') }}"
          ],
          "description": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Description', `La IA creara una descripcion de la reunion por si sola`, 'string') }}",
          "sendUpdates": "all",
          "summary": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Summary', `La IA creara un titulo de la reunion por si sola`, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.3,
      "position": [
        288,
        656
      ],
      "id": "04a39111-391c-4ce0-8f66-781f1bf50583",
      "name": "CrearReunion",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "WznQA6dKlkzBMCEP",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', `En el mensaje tienes que incluir el porque de la reunion y ademas la informacion de Google Calendar para que el usuario acepte la asignacion de la reuncion.`, 'string') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        400,
        256
      ],
      "id": "42db15bb-0a87-40eb-81a7-3d8e77467ef3",
      "name": "SendEmail",
      "webhookId": "cce244b9-a021-46a6-aad7-bae57c55a0b4",
      "credentials": {
        "gmailOAuth2": {
          "id": "D4cEbuX1DCtVGiuy",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message",
          "poll"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -944,
        -80
      ],
      "id": "7bef707c-bfc4-4308-8e61-bd0e220fdf3f",
      "name": "Telegram Trigger",
      "webhookId": "0049bb57-e505-41e7-88b5-2ff359eee465",
      "credentials": {
        "telegramApi": {
          "id": "edB74OvgZ2W7fYwL",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        464,
        -80
      ],
      "id": "4ecefef6-be2b-4a77-826a-bf6fdfa7fc0c",
      "name": "Send a text message",
      "webhookId": "2376e2cd-64dd-44fd-8d4a-83098fe1f9dd",
      "credentials": {
        "telegramApi": {
          "id": "edB74OvgZ2W7fYwL",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "cc7c9284-e4ee-4cae-bbbe-ff0876736bf1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3d791515-4b4c-414d-a92f-c1622f09ed65",
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -752,
        -96
      ],
      "id": "342276ec-6b23-4f6b-863f-cac346b3edef",
      "name": "Switch"
    },
    {
      "parameters": {
        "resource": "file",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -400,
        0
      ],
      "id": "14943848-072a-44cf-8762-856324d63ba5",
      "name": "Get a file",
      "webhookId": "fecd1a4f-bdcf-4075-9a7b-127aeaea679b",
      "credentials": {
        "telegramApi": {
          "id": "edB74OvgZ2W7fYwL",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -224,
        0
      ],
      "id": "9bfe0cc4-c597-4df6-ae4b-82f0b8a5517f",
      "name": "Transcribe a recording",
      "credentials": {
        "openAiApi": {
          "id": "n0wfPgDwiY0nvtW8",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fd30955b-caf8-4ae5-a75e-3f4a70ebf804",
              "name": "text",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -256,
        -192
      ],
      "id": "446b8b16-f361-4acb-a174-455bb839b14a",
      "name": "Edit Fields"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Knowler": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "CheckDisponibilidad": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "CrearReunion": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SendEmail": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "Transcribe a recording",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe a recording": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "timezone": "Europe/Madrid",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "f5fda3fe-59f8-46db-97ca-ed3b9b6d2ca3",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "50e908245cf6cca64bb82f82936896e49b0c1624b5b3352ac4dfa73bc56481dc"
  },
  "id": "gE17dGzn0yrPGDqO",
  "tags": []
}